# Selenium Headless æ¨¡å¼ä½¿ç”¨èªªæ˜

## ğŸ¯ æ¦‚è¿°

æˆ‘å€‘å·²ç¶“æˆåŠŸå°‡æ’ç¨‹ç™¼æ–‡è¨­å®šç‚ºä½¿ç”¨ **Headless æ¨¡å¼**ï¼Œé€™æ„å‘³è‘—æ’ç¨‹ç™¼æ–‡æ™‚ä¸æœƒå½ˆå‡ºç€è¦½å™¨è¦–çª—ï¼Œæœƒåœ¨èƒŒæ™¯é»˜é»˜åŸ·è¡Œï¼Œä¸æœƒæ‰“æ“¾æ‚¨çš„å·¥ä½œã€‚

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### **ä¿®æ”¹çš„æ–‡ä»¶**
- `Crawler/views.py` - æ·»åŠ äº† headless åƒæ•¸æ”¯æŒ
- `Crawler/management/commands/run_scheduler.py` - æ’ç¨‹ç™¼æ–‡ä½¿ç”¨ headless æ¨¡å¼

### **Headless æ¨¡å¼è¨­å®š**
```python
def _setup_driver(self, headless=False):
    """è¨­ç½® Chrome é©…å‹•ç¨‹å¼"""
    
    options = Options()
    
    if headless:
        # Headless æ¨¡å¼è¨­å®šï¼ˆèƒŒæ™¯åŸ·è¡Œï¼Œä¸é¡¯ç¤ºè¦–çª—ï¼‰
        options.add_argument("--headless=new")  # ä½¿ç”¨æ–°çš„ headless æ¨¡å¼
        options.add_argument("--disable-gpu")  # ç¦ç”¨ GPU åŠ é€Ÿ
        options.add_argument("--no-sandbox")  # ç¦ç”¨æ²™ç›’æ¨¡å¼
        options.add_argument("--disable-dev-shm-usage")  # ç¦ç”¨å…±äº«å…§å­˜
        options.add_argument("--window-size=1920,1080")  # è¨­å®šè¦–çª—å¤§å°
        options.add_argument("--user-agent=Mozilla/5.0...")  # è¨­å®šç”¨æˆ¶ä»£ç†
    else:
        # æ­£å¸¸æ¨¡å¼è¨­å®š
        options.add_argument("--start-maximized")  # æœ€å¤§åŒ–è¦–çª—
```

## ğŸ“‹ ä½¿ç”¨æ–¹æ³•

### **1. æ’ç¨‹ç™¼æ–‡ï¼ˆè‡ªå‹•ä½¿ç”¨ Headless æ¨¡å¼ï¼‰**
```python
# åœ¨ run_scheduler.py ä¸­
driver = facebook_view._setup_driver(headless=True)  # æ’ç¨‹ç™¼æ–‡ä½¿ç”¨ headless æ¨¡å¼
```

**ç‰¹é»ï¼š**
- âœ… **ä¸æœƒå½ˆå‡ºç€è¦½å™¨è¦–çª—**
- âœ… **åœ¨èƒŒæ™¯é»˜é»˜åŸ·è¡Œ**
- âœ… **ä¸æœƒæ‰“æ“¾æ‚¨å·¥ä½œ**
- âœ… **é©åˆè‡ªå‹•åŒ–é‹è¡Œ**

### **2. ç«‹å³ç™¼æ–‡ï¼ˆå¯é¸æ“‡æ¨¡å¼ï¼‰**
```python
# åœ¨ views.py ä¸­ï¼Œå¯ä»¥é¸æ“‡æ˜¯å¦ä½¿ç”¨ headless
driver = self._setup_driver(headless=False)  # é¡¯ç¤ºè¦–çª—ï¼Œæ–¹ä¾¿èª¿è©¦
# æˆ–
driver = self._setup_driver(headless=True)   # èƒŒæ™¯åŸ·è¡Œï¼Œä¸å¹²æ“¾
```

## ğŸ¯ ä½¿ç”¨å ´æ™¯

### **å ´æ™¯ 1ï¼šä¸Šç­æ™‚é–“æ’ç¨‹ç™¼æ–‡**
- **ä½¿ç”¨æ¨¡å¼**ï¼šHeadless æ¨¡å¼
- **æ•ˆæœ**ï¼šä¸æœƒå½ˆå‡ºç€è¦½å™¨è¦–çª—
- **å„ªé»**ï¼šåŒäº‹ä¸æœƒç™¼ç¾æ‚¨åœ¨è‡ªå‹•ç™¼æ–‡
- **é©åˆ**ï¼šéœ€è¦éš±å¯†æ€§çš„å ´åˆ

### **å ´æ™¯ 2ï¼šæ¸¬è©¦å’Œèª¿è©¦**
- **ä½¿ç”¨æ¨¡å¼**ï¼šæ­£å¸¸æ¨¡å¼ï¼ˆé headlessï¼‰
- **æ•ˆæœ**ï¼šå¯ä»¥çœ‹åˆ°ç€è¦½å™¨æ“ä½œéç¨‹
- **å„ªé»**ï¼šæ–¹ä¾¿æ‰¾å‡ºå•é¡Œæ‰€åœ¨
- **é©åˆ**ï¼šé–‹ç™¼å’Œæ¸¬è©¦éšæ®µ

### **å ´æ™¯ 3ï¼šæœå‹™å™¨ç’°å¢ƒ**
- **ä½¿ç”¨æ¨¡å¼**ï¼šå¿…é ˆä½¿ç”¨ Headless æ¨¡å¼
- **åŸå› **ï¼šæœå‹™å™¨é€šå¸¸æ²’æœ‰åœ–å½¢ç•Œé¢
- **é©åˆ**ï¼š24/7 è‡ªå‹•é‹è¡Œ

## ğŸš€ æ€§èƒ½å°æ¯”

| æ¨¡å¼ | è¨˜æ†¶é«”ä½¿ç”¨ | CPU ä½¿ç”¨ | åŸ·è¡Œé€Ÿåº¦ | è¦–è¦ºåé¥‹ | éš±å¯†æ€§ |
|------|------------|----------|----------|----------|--------|
| **æ­£å¸¸æ¨¡å¼** | é«˜ | é«˜ | ä¸­ç­‰ | âœ… å®Œæ•´ | âŒ ä½ |
| **Headless æ¨¡å¼** | ä½ | ä½ | å¿« | âŒ ç„¡ | âœ… é«˜ |

## ğŸ” æ¸¬è©¦ Headless æ¨¡å¼

### **é‹è¡Œæ¸¬è©¦è…³æœ¬**
```bash
python test_headless_mode.py
```

**æ¸¬è©¦å…§å®¹ï¼š**
1. **æ­£å¸¸æ¨¡å¼æ¸¬è©¦**ï¼šæœƒæ‰“é–‹ç€è¦½å™¨è¦–çª—
2. **Headless æ¨¡å¼æ¸¬è©¦**ï¼šä¸æœƒé¡¯ç¤ºè¦–çª—ï¼ŒèƒŒæ™¯åŸ·è¡Œ
3. **æ’ç¨‹æª¢æŸ¥**ï¼šé©—è­‰æ’ç¨‹è¨­å®š
4. **åŸ·è¡Œè¨˜éŒ„æª¢æŸ¥**ï¼šæŸ¥çœ‹æ­·å²åŸ·è¡Œæƒ…æ³

### **æ‰‹å‹•æ¸¬è©¦**
```python
# åœ¨ Django shell ä¸­æ¸¬è©¦
python manage.py shell

from Crawler.views import FacebookAutomationView
facebook_view = FacebookAutomationView()

# æ¸¬è©¦ headless æ¨¡å¼
driver = facebook_view._setup_driver(headless=True)
driver.get("https://www.google.com")
print(f"é é¢æ¨™é¡Œ: {driver.title}")
driver.quit()
```

## âš ï¸ æ³¨æ„äº‹é …

### **1. èª¿è©¦å›°é›£**
- Headless æ¨¡å¼ä¸‹ç„¡æ³•çœ‹åˆ°ç€è¦½å™¨æ“ä½œéç¨‹
- å‡ºç¾å•é¡Œæ™‚è¼ƒé›£è¨ºæ–·
- å»ºè­°é–‹ç™¼éšæ®µä½¿ç”¨æ­£å¸¸æ¨¡å¼

### **2. æŸäº›ç¶²ç«™å¯èƒ½æª¢æ¸¬**
- éƒ¨åˆ†ç¶²ç«™æœƒæª¢æ¸¬ headless æ¨¡å¼
- å¯èƒ½è¢«è­˜åˆ¥ç‚ºæ©Ÿå™¨äºº
- éœ€è¦é¡å¤–çš„åæª¢æ¸¬æªæ–½

### **3. åœ–ç‰‡å’Œ JavaScript**
- Headless æ¨¡å¼ä¸‹æŸäº›è¦–è¦ºæ•ˆæœå¯èƒ½ä¸å®Œæ•´
- è¤‡é›œçš„ JavaScript å¯èƒ½ç„¡æ³•æ­£å¸¸åŸ·è¡Œ
- å»ºè­°æ ¹æ“šéœ€è¦èª¿æ•´è¨­å®š

## ğŸ¯ æœ€ä½³å¯¦è¸

### **é–‹ç™¼éšæ®µ**
```python
# ä½¿ç”¨æ­£å¸¸æ¨¡å¼ï¼Œæ–¹ä¾¿èª¿è©¦
driver = self._setup_driver(headless=False)
```

### **ç”Ÿç”¢ç’°å¢ƒ**
```python
# ä½¿ç”¨ headless æ¨¡å¼ï¼Œæé«˜æ•ˆç‡
driver = self._setup_driver(headless=True)
```

### **æ··åˆä½¿ç”¨**
```python
# æ ¹æ“šç’°å¢ƒè®Šæ•¸æ±ºå®š
import os
headless = os.getenv('HEADLESS_MODE', 'false').lower() == 'true'
driver = self._setup_driver(headless=headless)
```

## ğŸ“š ç›¸é—œæ–‡æª”

- [SCHEDULER_README.md](./SCHEDULER_README.md) - æ’ç¨‹åŸ·è¡Œå™¨èªªæ˜
- [ADMIN_FILTERS_README.md](./ADMIN_FILTERS_README.md) - ç®¡ç†é é¢ç¯©é¸å™¨èªªæ˜

## ğŸ‰ ç¸½çµ

ç¾åœ¨æ‚¨çš„æ’ç¨‹ç™¼æ–‡ç³»çµ±å·²ç¶“å®Œå…¨æ”¯æ´ Headless æ¨¡å¼ï¼š

- âœ… **æ’ç¨‹ç™¼æ–‡**ï¼šè‡ªå‹•ä½¿ç”¨ Headless æ¨¡å¼ï¼Œä¸æœƒæ‰“æ“¾æ‚¨å·¥ä½œ
- âœ… **ç«‹å³ç™¼æ–‡**ï¼šå¯ä»¥é¸æ“‡æ˜¯å¦ä½¿ç”¨ Headless æ¨¡å¼
- âœ… **éˆæ´»é…ç½®**ï¼šæ ¹æ“šéœ€è¦èª¿æ•´åŸ·è¡Œæ¨¡å¼
- âœ… **æ€§èƒ½å„ªåŒ–**ï¼šHeadless æ¨¡å¼ç¯€çœè³‡æºï¼Œæé«˜æ•ˆç‡

äº«å—ç„¡å¹²æ“¾çš„è‡ªå‹•åŒ–ç™¼æ–‡é«”é©—ï¼ğŸ¯
